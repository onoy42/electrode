<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@xarc/app</title>
	<meta name="description" content="Documentation for @xarc/app">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@xarc/app</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>@xarc/app</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#archetype-electrode-react-isomorphic-universal-app" id="archetype-electrode-react-isomorphic-universal-app" style="color: inherit; text-decoration: none;">
					<h1>Archetype: Electrode React <del>Isomorphic</del> Universal App</h1>
				</a>
				<p><a href="https://npmjs.org/package/@xarc/app"><img src="https://badge.fury.io/js/@xarc/app.svg" alt="NPM version"></a> <a href="https://david-dm.org/electrode-io/electrode?path=packages/@xarc/app"><img src="https://david-dm.org/electrode-io/electrode/status.svg?path=packages/@xarc/app" alt="Dependency Status"></a> <a href="https://david-dm.org/electrode-io/electrode?path=packages/@xarc/app?type-dev"><img src="https://david-dm.org/electrode-io/electrode/dev-status.svg?path=packages/@xarc/app" alt="devDependency Status"></a> <a href="https://www.npmjs.com/package/@xarc/app"><img src="https://img.shields.io/npm/dm/@xarc/app.svg" alt="npm downloads"></a></p>
				<p>A Walmart Labs flavored React Universal App archetype.</p>
				<a href="#have-a-question-check-the-faq" id="have-a-question-check-the-faq" style="color: inherit; text-decoration: none;">
					<h2>Have a question? Check the <a href="./FAQ.md">FAQ</a></h2>
				</a>
				<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
					<h2>Installation</h2>
				</a>
				<blockquote>
					<p>NOTE: Generally you don&#39;t need to install these modules directly. You should start your app by using our Yeoman <a href="https://www.npmjs.com/package/generator-electrode">generator-electrode</a> or check our <a href="http://www.electrode.io/docs/get_started.html">Electrode getting started</a> guide.</p>
				</blockquote>
				<p>However, if you are manually creating your app:</p>
				<a href="#install-the-two-complementary-modules" id="install-the-two-complementary-modules" style="color: inherit; text-decoration: none;">
					<h6>Install the two complementary modules</h6>
				</a>
				<pre><code class="language-bash">$ npm install --save @xarc/app
$ npm install --save-dev @xarc/app-dev</code></pre>
				<a href="#add-a-xclapjs" id="add-a-xclapjs" style="color: inherit; text-decoration: none;">
					<h6>Add a <code>xclap.js</code></h6>
				</a>
				<p>The <code>xclap.js</code> should contain the following and be located in the root of your project</p>
				<pre><code class="language-js"><span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@xarc/app&quot;</span>)();</code></pre>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h2>Usage</h2>
				</a>
				<p>The primary interface to the archetype is a list of tasks you can invoke with clap to do your bidding.</p>
				<p>To see the tasks, simply run:</p>
				<pre><code class="language-bash">$ clap</code></pre>
				<p>To invoke a task, for example, the <code>dev</code> task, run:</p>
				<pre><code class="language-bash">$ clap dev</code></pre>
				<a href="#directory-structure" id="directory-structure" style="color: inherit; text-decoration: none;">
					<h2>Directory Structure</h2>
				</a>
				<p>The archetype supports the <a href="#srclib-mode">src/lib</a> directory structure. In this mode, you put your <code>client</code> and <code>server</code> code under the <code>src</code> directory and the <code>build</code> task will transpile them into the <code>lib</code> directory during build time.</p>
				<p>If you are not currently using this directory structure, please read the <a href="#srclib-mode">src/lib</a> section for migration instructions</p>
				<a href="#opt-in-features" id="opt-in-features" style="color: inherit; text-decoration: none;">
					<h2>Opt-in features</h2>
				</a>
				<a href="#run-time-support-api" id="run-time-support-api" style="color: inherit; text-decoration: none;">
					<h3>Run time support API</h3>
				</a>
				<p>For the things that should be initialized at your Node server&#39;s startup, they are all combined into a single API in the archetype as <code>support.load</code>.</p>
				<p>Here is how you can use it:</p>
				<p>In your <code>server/index.js</code>:</p>
				<pre><code class="language-js"><span class="hljs-keyword">const</span> support = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@xarc/app/support&quot;</span>);
<span class="hljs-keyword">const</span> electrodeServer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;electrode-server&quot;</span>);
<span class="hljs-keyword">const</span> electrodeConfippet = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;electrode-confippet&quot;</span>);

support
  .load()
  .then(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> electrodeServer(electrodeConfippet.config);
  })
  .catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Server start failed&quot;</span>, e); <span class="hljs-comment">// eslint-disable-line no-console</span>
  });</code></pre>
				<p>If you are using this API, then things like isomorphic support and React module optimization are handled for you.</p>
				<p>It accepts a single <code>options</code> object, with the following supported fields:</p>
				<ul>
					<li><p><code>babelRegister</code> - Set to <code>false</code> to disable loading <code>babel-register</code></p>
					</li>
					<li><p><code>cssModuleHook</code> - Set to <code>false</code> to disable loading [css-module-hook]</p>
						<ul>
							<li>If this is an object, then it&#39;s used as <code>options</code> for <code>cssModuleHook</code></li>
						</ul>
					</li>
					<li><p><code>isomorphicExtendRequire</code> - Set to <code>false</code> to disable loading isomorphic-loader support</p>
					</li>
				</ul>
				<a href="#srclib-mode" id="srclib-mode" style="color: inherit; text-decoration: none;">
					<h3>src/lib Mode</h3>
				</a>
				<p>In order to avoid requiring run time babel transpilation, this archetype supports a src/lib app mode. To use this, you need to put your <code>client</code> and <code>server</code> into a <code>src</code> directory. The archetype&#39;s <code>build</code> task will transpile those into the <code>lib</code> directory.</p>
				<blockquote>
					<p>The archetype <code>build</code> task will only overwrite <code>lib/client</code> and <code>lib/server</code>. So you can put other normal code under <code>lib</code> if you want.</p>
					<p>If you are migrating from the deprecated babel-register mode, then you should move your code to <code>src</code> directory. For the most part, there should be very little you need to change except if you have code that refers to those two directories explicitly from outside.</p>
				</blockquote>
				<p>You will also need to use the <a href="#run-time-support-api">Run time support API</a> to initialize your server startup.</p>
				<a href="#src-or-lib" id="src-or-lib" style="color: inherit; text-decoration: none;">
					<h4><code>src</code> or <code>lib</code>?</h4>
				</a>
				<p>So where is your code being executed from? <code>src</code> or <code>lib</code>? Actually, it could be either, depending on <code>NODE_ENV</code>.</p>
				<p>If you need to refer to your client or server code from outside, you can use <a href="#app_src_dir"><code>APP_SRC_DIR</code> environment variable</a> to automatically refer to the directory where code is being executed from.</p>
				<p>For UI code under <code>src/client</code> or <code>test/client</code>, webpack config sets <code>src</code> as a root so you can refer to code in <code>src/client</code> with <code>&quot;client/foo&quot;</code>.</p>
				<p>For example:</p>
				<pre><code class="language-js"><span class="hljs-keyword">import</span> Hello <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;client/components/hello&quot;</span>;</code></pre>
				<p>For code under <code>src/server</code>, you can refer to client with <code>&quot;../client/foo&quot;</code>.</p>
				<a href="#development" id="development" style="color: inherit; text-decoration: none;">
					<h5>development</h5>
				</a>
				<p>In dev mode, your code will be executed from the <code>src</code> directory. Your client code is transpiled and packed by <code>webpack-dev-middleware</code> on the fly. Your node server is executed by <code>babel-node</code>.</p>
				<a href="#production" id="production" style="color: inherit; text-decoration: none;">
					<h5>production</h5>
				</a>
				<p>In prod mode, your client code is being loaded from the bundle packed by webpack. On server side, SSR will load client code from <code>lib</code> and your node server being executed from the <code>lib/server</code> directory. ie: <code>NODE_ENV=production node lib/server/index.js</code></p>
				<a href="#babelrc" id="babelrc" style="color: inherit; text-decoration: none;">
					<h4>.babelrc</h4>
				</a>
				<p>An independent <code>.babelrc</code> file will be automatically generated for you in both <code>src/client</code> and <code>src/server</code>. The one for client is setup for React and the one for server is setup for the NodeJS version you are using.</p>
				<a href="#app_src_dir" id="app_src_dir" style="color: inherit; text-decoration: none;">
					<h4>APP_SRC_DIR</h4>
				</a>
				<p>An env variable <code>APP_SRC_DIR</code> is always set by the <a href="#run-time-support-api">Run time support API</a> to indicate where your code is running from. If your app config needs to refer to some code there, you can use this.</p>
				<p><strong>NOTE:</strong> The dir path set in <code>$APP_SRC_DIR</code> will include the trailing <code>/</code> automatically. ie: <code>src/</code> or <code>lib/</code></p>
				<p>For example, to pass your server side React app entry to react-webapp:</p>
				<pre><code class="language-js">{
  <span class="hljs-string">&quot;plugins&quot;</span>: {
    <span class="hljs-string">&quot;electrode-react-webapp&quot;</span>: {
      <span class="hljs-string">&quot;options&quot;</span>: {
        <span class="hljs-string">&quot;pageTitle&quot;</span>: <span class="hljs-string">&quot;Getting Started&quot;</span>,
        <span class="hljs-string">&quot;paths&quot;</span>: {
          <span class="hljs-string">&quot;/{args*}&quot;</span>: {
            <span class="hljs-string">&quot;view&quot;</span>: <span class="hljs-string">&quot;index&quot;</span>,
            <span class="hljs-string">&quot;content&quot;</span>: {
              <span class="hljs-string">&quot;module&quot;</span>: <span class="hljs-string">&quot;./{{env.APP_SRC_DIR}}/server/app&quot;</span>   <span class="hljs-comment">// Note the use of APP_SRC_DIR here</span>
            }
          }
        }
      }
    }
  }
}</code></pre>
				<a href="#npm-prune-for-production" id="npm-prune-for-production" style="color: inherit; text-decoration: none;">
					<h4>NPM Prune for production</h4>
				</a>
				<p>Starting with version 9.4.0, the archetypes now fully support your application running without the development archetype. Make sure you install <code>@xarc/app</code> under your <code>dependencies</code> and <code>@xarc/app-dev</code> under <code>devDependencies</code> and you can run <code>npm prune --production</code> on your app to clear <code>devDependencies</code>. If you are using the electrode-build script in your build job, you can set the build parameter <code>PRUNE_DEV_DEPENDENCIES</code> to true.</p>
				<blockquote>
					<p>NOTE: if your app runs in production mode but rely on something else you&#39;ve put under <code>devDependencies</code> then doing <code>npm prune --production</code> will still break your app.</p>
				</blockquote>
				<a href="#define-client-entry-points" id="define-client-entry-points" style="color: inherit; text-decoration: none;">
					<h4>Define client entry points</h4>
				</a>
				<p>By default, the archetype uses <code>client/app.js</code> or <code>client/app.jsx</code> as a client entry point. Alternatively,
					you can define multiple entry points for your application, so the Webpack will create bundles for each app
				entry point. To do that, place <code>entry.config.js</code> module into your app&#39;s <code>client</code> directory:</p>
				<p>Here is an <strong>example</strong> of <code>entry.config.js</code>:</p>
				<pre><code class="language-js"><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">web</span>: <span class="hljs-string">&quot;./app-web.js&quot;</span>,
  <span class="hljs-attr">ios</span>: <span class="hljs-string">&quot;./app-ios.js&quot;</span>,
  <span class="hljs-attr">android</span>: <span class="hljs-string">&quot;./app-android.js&quot;</span>
};</code></pre>
				<a href="#nodejs-server-required-runtime-support" id="nodejs-server-required-runtime-support" style="color: inherit; text-decoration: none;">
					<h2>NodeJS Server Required Runtime Support</h2>
				</a>
				<p>If you don&#39;t use the <code>support.load</code> API to get the runtime support needed for some of the features in your NodeJS server, then you need to initialize them manually during your server startup.</p>
				<a href="#babel-coreregister" id="babel-coreregister" style="color: inherit; text-decoration: none;">
					<h3><code>babel-core/register</code></h3>
				</a>
				<p>If you are using the babel-register mode, then you need to load the <code>babel-register</code> module.</p>
				<p>If you don&#39;t have a build step for your server code, then you must transpile
					on the fly using <code>babel-register</code>. For performance reasons, we recommend
					whitelisting the <code>react</code> module to be transpiled as well, so that the
				<code>transform-node-env-inline</code> plugin gets applied to the React codebase:</p>
				<pre><code class="language-js"><span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;babel-core/register&quot;</span>)({
  <span class="hljs-attr">ignore</span>: <span class="hljs-regexp">/node_modules\/(?!react\/)/</span>
});</code></pre>
				<a href="#cssmodulehook-for-isomorphic-css-modules" id="cssmodulehook-for-isomorphic-css-modules" style="color: inherit; text-decoration: none;">
					<h3><code>cssModuleHook</code> for isomorphic CSS modules</h3>
				</a>
				<p>If you want to enable isomorphic css modules, the server needs to know how to import css files
					and generate unique class names.
				The archetype can handle this for you using the <code>supports</code> module. In your server entry point:</p>
				<pre><code class="language-js"><span class="hljs-keyword">var</span> supports = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@xarc/app/supports&quot;</span>);

supports.cssModuleHook();</code></pre>
				<a href="#extending-webpack-configuration" id="extending-webpack-configuration" style="color: inherit; text-decoration: none;">
					<h2>Extending Webpack Configuration</h2>
				</a>
				<p>The webpack config for your app is being generated by the archetype. While composing the webpack config, the archetype looks for the <code>archetype/config</code> folder at the project root of your app.</p>
				<p>In order to override or extend the webpack configuration you should create a file under <code>archetype/config/webpack</code>.</p>
				<p>Your directory structure should look like this:</p>
				<pre><code class="language-bash">archetype
└── config
    └── webpack
        └── webpack.config.js</code></pre>
				<p>Where <code>webpack.config.js</code> is your extended or overriding webpack config, for example:</p>
				<pre><code class="language-js"><span class="hljs-keyword">const</span> BellOnBundlerErrorPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;bell-on-bundler-error-plugin&quot;</span>);

<span class="hljs-keyword">const</span> config = {
  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> BellOnBundlerErrorPlugin()]
};

<span class="hljs-built_in">module</span>.exports = config;</code></pre>
				<p>Built with :heart: by <a href="https://github.com/orgs/electrode-io/people">Team Electrode</a> @WalmartLabs.</p>
				<hr>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_index_.html">&quot;index&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>